<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HEY KAVA – ワンタップETA</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;line-height:1.6}
    input,button{font-size:16px;padding:10px;border:1px solid #ccc;border-radius:10px}
    button{cursor:pointer}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    #linkBox{margin-top:12px;padding:12px;background:#f6f6f6;border-radius:10px;word-break:break-all}
    small{color:#666}
  </style>
</head>
<body>
  <h1>HEY KAVA – ワンタップETA</h1>
  <p>行き先を入れて <b>現在地→目的地</b> のルートを開く。共有用リンクも作るよ。</p>

  <div class="row">
    <input id="dest" type="text" placeholder="例：川崎駅／住所／店名" style="flex:1;min-width:220px" />
    <button id="goBtn">開く</button>
  </div>
  <p style="margin:8px 0 0"><small>※ 初回は位置情報の許可を“許可”にしてね。</small></p>

  <div id="linkBox" style="display:none">
    <div><b>共有リンク</b></div>
    <div id="gmapsLink"></div>
    <div id="amapsLink" style="margin-top:8px"></div>
    <div class="row" style="margin-top:8px">
      <button id="copyBtn">リンクをコピー</button>
    </div>
  </div>

  <script>
    const goBtn = document.getElementById('goBtn');
    const destInput = document.getElementById('dest');
    const box = document.getElementById('linkBox');
    const gmapsDiv = document.getElementById('gmapsLink');
    const amapsDiv = document.getElementById('amapsLink');
    const copyBtn = document.getElementById('copyBtn');

    function enc(s){ return encodeURIComponent(s.trim()); }

    function buildLinks(lat, lng, dest){
      const origin = `${lat},${lng}`;
      const gmaps = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${enc(dest)}&travelmode=driving`;
      const amaps = `http://maps.apple.com/?saddr=${origin}&daddr=${enc(dest)}&dirflg=d`;
      return { gmaps, amaps };
    }

    async function copyToClipboard(text){
      try {
        await navigator.clipboard.writeText(text);
        alert('リンクをコピーしました');
      } catch {
        alert('コピーできない場合は手動で長押しコピーしてね');
      }
    }

    goBtn.addEventListener('click', () => {
      const dest = destInput.value;
      if(!dest.trim()){ alert('行き先を入力してね'); destInput.focus(); return; }
      if(!navigator.geolocation){ alert('この端末で位置情報が使えません'); return; }

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const {latitude, longitude} = pos.coords;
          const { gmaps, amaps } = buildLinks(latitude, longitude, dest);

          // 端末のデフォルトマップを優先して開く（iPhoneはApple Mapsが既定）
          window.location.href = amaps;

          // 共有用リンクを画面にも表示
          box.style.display = 'block';
          gmapsDiv.innerHTML = `<a href="${gmaps}">Google Mapsで開く</a>`;
          amapsDiv.innerHTML = `<a href="${amaps}">Apple Mapsで開く</a>`;
          copyBtn.onclick = () => copyToClipboard(amaps + '\n' + gmaps);
        },
        (err) => {
          alert('位置情報が取得できませんでした。設定からSafariの位置情報を許可してね。\n' + err.message);
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    });
  </script>
</body>
</html>
